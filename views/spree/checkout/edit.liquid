{% content_for head %}
    <script src="/assets/checkout.js" type="text/javascript"></script>
{% end_content_for %}

<h1>Checkout</h1>
<div class="checkout">
    <ul id="checkout_steps" class="nav nav-pills">
      <li data-qrepeat="crumb progress" data-qattr="class crumb.state" class="">
        <a data-qtext="crumb.label" data-qattr="href crumb.link" href="#"></a>
      </li>
    </ul>
    <script type="text/javascript">
      $(document).ready(function(){
        var steps = {{ checkout_progress_json }};
        $('#checkout_steps').distal(steps);
      });
    </script>

    {% capture error_messages_for %}{% error_messages_for order %}{% endcapture %}
    {% if error_messages_for.size != 0 %}
    <div class="alert alert-error">
      <button type="button" class="close" data-dismiss="alert">&times;</button>
      <a data-toggle="collapse" href="#error-content"><strong>Oh no!</strong> An error has occured. Click here for more information.</a>
      <div id="error-content" class="collapse">
        <ul style="margin-top: 10px;">
          <li data-qrepeat="error errors" data-qtext="error"></li>
        </ul>
      </div>
    </div>
    <script type="text/javascript">
      $(document).ready(function(){
        var errors = {{error_messages_for}};
        $('#error-content').distal(errors);
      });
    </script>
    {% endif %}

    {% form_for order as:post url_helper:update_checkout_path, url_helper_params:order.state, method:put, html:"{ id:'checkout-form', class:'checkout-form form-horizontal'}" %}

    {% if order.state == 'address'  %}
    <div class="checkout-content" style="display: block">{% include 'spree/checkout/address' %}</div>
    {% endif %}

    {% if order.state == 'delivery'  %}
    <div class="checkout-content" style="display: block">{% include 'spree/checkout/delivery' %}</div>
    {% endif %}

    {% if order.state == 'payment' %}
    <div class="checkout-content" style="display: block">{% include 'spree/checkout/payment' %}</div>
    {% endif %}

    {% if order.state == 'confirm' %}
    <div class="checkout-content" style="display: block">{% include 'spree/checkout/confirm' %}</div>
    {% endif %}

    <div class="clearfix"></div>
    <div style="padding-top: 20px;">
      {% if order.state == 'confirm' %}
      <button type="submit" class="btn btn-primary">Place Order</button>
      {% else %}
      <button type="submit" class="btn btn-primary">Continue</button>
      {% endif %}
    </div>

    {% endform_for %}
</div>
